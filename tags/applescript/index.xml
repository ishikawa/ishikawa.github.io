<?xml version="1.0" encoding="utf-8" standalone="yes" ?>
<rss version="2.0" xmlns:atom="http://www.w3.org/2005/Atom">
  <channel>
    <title>Applescript on METAREAL</title>
    <link>http://www.metareal.org/tags/applescript/index.xml</link>
    <description>Recent content in Applescript on METAREAL</description>
    <generator>Hugo -- gohugo.io</generator>
    <language>ja-JP</language>
    <copyright>copyright © 2006-Present Takanori Ishikawa.</copyright>
    <atom:link href="http://www.metareal.org/tags/applescript/index.xml" rel="self" type="application/rss+xml" />
    
    <item>
      <title>Safari で開いているページのリンクを Evernote クライアントに送る</title>
      <link>http://www.metareal.org/2008/12/09/copy-link-to-evernote-client-applescript/</link>
      <pubDate>Tue, 09 Dec 2008 03:37:00 +0900</pubDate>
      
      <guid>http://www.metareal.org/2008/12/09/copy-link-to-evernote-client-applescript/</guid>
      <description>

&lt;p&gt;最近、プログラミング関係のまとめやインストール手順の記録といったものには &lt;a href=&#34;http://evernote.com/&#34;&gt;Evernote&lt;/a&gt; を利用している。&lt;/p&gt;

&lt;p&gt;&lt;a href=&#34;http://netafull.net/tech/024525.html&#34;&gt;画像中の手書き文字認識&lt;/a&gt;や「&lt;a href=&#34;http://jp.techcrunch.com/archives/extend-your-brain-with-evernote-private-beta-invites/&#34;&gt;脳を拡張する&lt;/a&gt;」といった誇大広告ばかりが取り沙汰されるサービスだが、単純にメモツールとして優れており、特に &lt;a href=&#34;http://www.evernote.com/about/download/&#34;&gt;Mac クライアント&lt;/a&gt;と &lt;a href=&#34;http://www.evernote.com/about/download/iphone/&#34;&gt;iPhone クライアント&lt;/a&gt;の出来がすばらしい。&lt;/p&gt;

&lt;h3 id=&#34;evernote-mac-クライアント&#34;&gt;Evernote: Mac クライアント&lt;/h3&gt;

&lt;p&gt;プログラミング関係の話題をノートにまとめていると、興味深いページへのリンクを多く埋め込むことになる。ノートの編集は Mac のクライアントで行うことが多いのだが、この作業がけっこう面倒だ：&lt;/p&gt;

&lt;ol&gt;
&lt;li&gt;Safari で開いているページのタイトルをコピーして、Evernote クライアントにペースト&lt;/li&gt;
&lt;li&gt;コピーしたタイトルを選択&lt;/li&gt;
&lt;li&gt;リンクを追加するためのシートを表示&lt;/li&gt;
&lt;li&gt;Safari で開いているページの URL をコピーして、Evernote クライアントにペースト&lt;/li&gt;
&lt;li&gt;OK ボタンをクリック&lt;/li&gt;
&lt;/ol&gt;

&lt;p&gt;この手順を毎回、繰り返さなければならない。慣れれば無意識に出来るような単純作業ではあるが、単純作業なら自動化した方がいい。&lt;/p&gt;

&lt;h3 id=&#34;applescript&#34;&gt;AppleScript&lt;/h3&gt;

&lt;p&gt;Mac で自動化といえば &lt;a href=&#34;http://www.apple.com/applescript/&#34;&gt;AppleScript&lt;/a&gt; の出番なのだが、残念ながら Mac 向け Evernote クライアントの AppleScript 対応は今回の要件には不十分である。そのため、今回は System Events による GUI スクリプティングにより、上記手順のキー操作やボタンクリックをエミュレートすることにした。&lt;/p&gt;

&lt;pre&gt;&lt;code class=&#34;language-applescript&#34;&gt;-- EvernoteCopyLink.applescript
-- Copy title and URL in the front most window of Safari to Evernote with link
-- Author: Takanori Ishikawa

on copyLinkToEvernote(theTitle, theURL)
  tell application &amp;quot;System Events&amp;quot;
    -- copy &amp;amp;amp; paste
    set the clipboard to theTitle as text
    keystroke &amp;quot;v&amp;quot; using command down

    tell process &amp;quot;Evernote&amp;quot;
      -- Select pasted text
      -- Note 1: &#39;ASCII character 28&#39; means &#39;move left&#39;.
      -- Note 2: &amp;quot;shift + option&amp;quot; selection might be more efficient,
      --         but it does not work correctly with Japanese text.
      (*
      repeat (length of words of theTitle) times
        keystroke (ASCII character 28) using {shift down, option down}
      end repeat
      *)
      repeat length of theTitle times
        keystroke (ASCII character 28) using shift down
      end repeat

      -- Link, Add...
      keystroke &amp;quot;k&amp;quot; using command down
      delay 0.1
      set the clipboard to theURL as text
      keystroke &amp;quot;v&amp;quot; using command down

      -- click &amp;quot;OK&amp;quot;
      delay 0.1
      repeat with w in windows
        if exists sheet 1 of w then
          click button &amp;quot;OK&amp;quot; of sheet 1 of w
        end if
      end repeat

    end tell
  end tell
end copyLinkToEvernote

tell application &amp;quot;System Events&amp;quot;
  if not (exists application process &amp;quot;Evernote&amp;quot;) or not (exists application process &amp;quot;Safari&amp;quot;) then
    display alert &amp;quot;Evernote and Safari Required&amp;quot; message &amp;quot;You have to launch Evernote and Safari before executing script&amp;quot;
  end if
end tell

tell first document of application &amp;quot;Safari&amp;quot;
  set pageTitle to name
  set pageURL to URL
end tell

tell application &amp;quot;Evernote&amp;quot; to activate
set theClipboard to the clipboard
copyLinkToEvernote(pageTitle, pageURL)
set the clipboard to theClipboard
&lt;/code&gt;&lt;/pre&gt;

&lt;p&gt;このスクリプトを実行すると、Safari で開いているページのリンクを、Evernote クライアントのノートに挿入することができる。スクリプト・メニューに登録して、しばらく使ってみるつもりだ。スクリプトは &lt;a href=&#34;http://gist.github.com/33786&#34;&gt;gist:33786&lt;/a&gt; でも公開している。&lt;/p&gt;

&lt;p&gt;Note&lt;/p&gt;

&lt;p&gt;System Events を使っているため、上記スクリプトを実行するには「システム環境設定」＞「ユニバーサル・アクセス」＞「補助装置にアクセスできるようにする」チェックボックスをオンにする必要がある。&lt;/p&gt;

&lt;p&gt;なお、&lt;a href=&#34;http://pygments.org/&#34;&gt;Pygments&lt;/a&gt; による AppleScript ソースコードのハイライトには自作の &lt;a href=&#34;http://github.com/ishikawa/pygments-applescript-lexer/tree/master&#34;&gt;The Pygments lexer for AppleScript language&lt;/a&gt; を使用した。AppleScript 構文のサポートはまだ完全ではないが、何もないよりはマシだろう。&lt;/p&gt;

&lt;p&gt;&lt;strong&gt;（2008/12/13 追記）&lt;/strong&gt;&lt;a href=&#34;http://pygments.org/download/&#34;&gt;Pygments 1.0&lt;/a&gt; で AppleScript のサポートが&lt;a href=&#34;http://dev.pocoo.org/projects/pygments/browser/CHANGES?rev=710%3Aa5748745272a&#34;&gt;追加された&lt;/a&gt;。このブログも Pygments 1.0 にアップデートし、自作のモジュールは OBSOLETE 扱いとした。&lt;/p&gt;
</description>
    </item>
    
    <item>
      <title>Mail.app を vacuum して高速化</title>
      <link>http://www.metareal.org/2007/08/23/optimize-the-apple-mail-app-database/</link>
      <pubDate>Fri, 24 Aug 2007 05:38:00 +0900</pubDate>
      
      <guid>http://www.metareal.org/2007/08/23/optimize-the-apple-mail-app-database/</guid>
      <description>&lt;p&gt;&lt;a href=&#34;http://www.sqlite.org/&#34;&gt;SQLite&lt;/a&gt; の &lt;code&gt;vacuum&lt;/code&gt; コマンドで Mail.app を高速化する。ターミナルで、&lt;/p&gt;

&lt;pre&gt;&lt;code&gt;% cd ~/Library/Mail/; sqlite3 Envelope\ Index &amp;quot;vacuum;&amp;quot;
&lt;/code&gt;&lt;/pre&gt;

&lt;p&gt;Automator で自動化する &lt;a href=&#34;http://automatorworld.com/archives/mail-vacuum/&#34;&gt;Mail Vacuum&lt;/a&gt; なんてのもある。&lt;/p&gt;

&lt;p&gt;個人的には、以下のような AppleScript を、&lt;/p&gt;

&lt;pre&gt;&lt;code&gt;tell application &amp;quot;Terminal&amp;quot;
  activate
  do script &amp;quot;cd ~/Library/Mail/; sqlite3 Envelope\\ Index \&amp;quot;vacuum;\&amp;quot;&amp;quot;
end tell
&lt;/code&gt;&lt;/pre&gt;

&lt;p&gt;&lt;code&gt;Optimize Mail.app.scpt&lt;/code&gt; として保存し、QuickSilver から実行できるようにしている。&lt;/p&gt;
</description>
    </item>
    
    <item>
      <title>QuickSilver でスクリーンセイバーを起動</title>
      <link>http://www.metareal.org/2007/03/28/launch-screen-saver-from-quicksilver/</link>
      <pubDate>Thu, 29 Mar 2007 01:21:00 +0900</pubDate>
      
      <guid>http://www.metareal.org/2007/03/28/launch-screen-saver-from-quicksilver/</guid>
      <description>&lt;p&gt;わたしは不器用なので、スクリーンセイバーをホットコーナーから起動しようとするたびに失敗する（スクリーンセイバーが起動したとたんに、微妙にマウスを動かしてしまって、起動が解除されてしまう）。&lt;/p&gt;

&lt;p&gt;&lt;a href=&#34;http://quicksilver.blacktree.com/&#34;&gt;QuickSilver&lt;/a&gt; から起動できたら便利だなと思って、スクリーンセイバーを起動する &lt;code&gt;AppleScript&lt;/code&gt; を書いて、&lt;code&gt;~/Library/Scripts/&lt;/code&gt; に置いてある。&lt;/p&gt;

&lt;pre&gt;&lt;code&gt;tell application &amp;quot;Finder&amp;quot;
  open application file &amp;quot;/System/Library/Frameworks/ScreenSaver.framework/Resources/ScreenSaverEngine.app&amp;quot; as POSIX file
end tell
&lt;/code&gt;&lt;/pre&gt;

&lt;p&gt;ホットキーにも登録してみたが、いちいち QuickSilver を起動してタイプする方が性にあっているようだ。&lt;/p&gt;
</description>
    </item>
    
    <item>
      <title>AppleScript で Markdown 記法のリンクを自動挿入 (2)</title>
      <link>http://www.metareal.org/2007/01/05/markdownized-autolink-with-applescript-2/</link>
      <pubDate>Sat, 06 Jan 2007 04:10:00 +0900</pubDate>
      
      <guid>http://www.metareal.org/2007/01/05/markdownized-autolink-with-applescript-2/</guid>
      <description>&lt;p&gt;「&lt;a href=&#34;http://weblog.metareal.org/2007/01/04/markdownized-autolink-with-applescript/&#34;&gt;AppleScript で Markdown 記法のリンクを自動挿入&lt;/a&gt;」のスクリプトを更に改良して、&lt;strong&gt;選択範囲がない場合は Web ページのタイトルをそのまま挿入する&lt;/strong&gt;ようにした。&lt;/p&gt;

&lt;pre&gt;&lt;code&gt;tell first document of application &amp;quot;Safari&amp;quot;
  set pageTitle to name
  set pageURL to URL
end tell

tell first document of application &amp;quot;mi&amp;quot;
  set newText to selection as Unicode text
  if (count of newText) = 0 then
    set newText to pageTitle
  end if
  set selection to &amp;quot;[&amp;quot; &amp;amp; newText &amp;amp; &amp;quot;](&amp;quot; &amp;amp; pageURL &amp;amp; &amp;quot; \&amp;quot;&amp;quot; &amp;amp; pageTitle &amp;amp; &amp;quot;\&amp;quot;)&amp;quot;
end tell
&lt;/code&gt;&lt;/pre&gt;

&lt;p&gt;これでだいぶ楽になったな。&lt;/p&gt;
</description>
    </item>
    
    <item>
      <title>AppleScript で Markdown 記法のリンクを自動挿入</title>
      <link>http://www.metareal.org/2007/01/04/markdownized-autolink-with-applescript/</link>
      <pubDate>Fri, 05 Jan 2007 01:33:00 +0900</pubDate>
      
      <guid>http://www.metareal.org/2007/01/04/markdownized-autolink-with-applescript/</guid>
      <description>&lt;p&gt;以前の記事「&lt;a href=&#34;http://weblog.metareal.org/2007/01/02/copy-page-title-with-applescript/&#34;&gt;AppleScript で Web ページのタイトルをクリップボードにコピー&lt;/a&gt;」を改良して、Markdown 記法でのリンクを自動挿入するようにしてみた（エディタは &lt;a href=&#34;http://www.mimikaki.net/&#34;&gt;mi&lt;/a&gt; に対応）。&lt;/p&gt;

&lt;pre&gt;&lt;code&gt;tell first document of application &amp;quot;Safari&amp;quot;
  set pageTitle to name
  set pageURL to URL
end

tell first document of application &amp;quot;mi&amp;quot;
  set selection to &amp;quot;[&amp;quot; &amp;amp; selection &amp;amp; &amp;quot;](&amp;quot; &amp;amp; pageURL &amp;amp; &amp;quot; \&amp;quot;&amp;quot; &amp;amp; pageTitle &amp;amp; &amp;quot;\&amp;quot;)&amp;quot;
end
&lt;/code&gt;&lt;/pre&gt;

&lt;p&gt;まずは、このスクリプトを mi のツールとして登録。
あとはリンクを貼りたい文字列を選択して、このスクリプトを実行すれば、Safari で開いているページへのリンクが自動的に挿入される、という寸法。&lt;/p&gt;

&lt;p&gt;たとえば「mi」という文字列を選択して、&lt;a href=&#34;http://www.mimikaki.net/&#34;&gt;mi&lt;/a&gt; のページを Safari で開いている場合は、&lt;/p&gt;

&lt;pre&gt;&lt;code&gt;[mi](http://www.mimikaki.net/ &amp;quot;mi&amp;quot;)
&lt;/code&gt;&lt;/pre&gt;

&lt;p&gt;というリンクが自動挿入される。&lt;/p&gt;
</description>
    </item>
    
    <item>
      <title>AppleScript で Web ページのタイトルをクリップボードにコピー</title>
      <link>http://www.metareal.org/2007/01/02/copy-page-title-with-applescript/</link>
      <pubDate>Wed, 03 Jan 2007 12:18:00 +0900</pubDate>
      
      <guid>http://www.metareal.org/2007/01/02/copy-page-title-with-applescript/</guid>
      <description>&lt;p&gt;Web ページのタイトルをブログに書くときに、毎回ソースを開いてコピーするのが面倒だった。なので、これを自動化する &lt;code&gt;AppleScript&lt;/code&gt; を書いた。&lt;/p&gt;

&lt;pre&gt;&lt;code&gt;tell application &amp;quot;Safari&amp;quot;
  set the clipboard to the name of front document **as Unicode text**
end tell
&lt;/code&gt;&lt;/pre&gt;

&lt;p&gt;このスクリプトを実行すると、Safari で開いている Web ページのタイトルがクリップボードにコピーされる。&lt;/p&gt;

&lt;p&gt;強調部分がないとクリップボードにコピーされないし、ここが &lt;em&gt;as text&lt;/em&gt; だと文字化けする。&lt;/p&gt;
</description>
    </item>
    
  </channel>
</rss>