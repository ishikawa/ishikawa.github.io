<!doctype html>
<html class="no-js" lang="ja">
<head>
  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <base href="http://ishikawa.github.io">
  <title>Flickr の JSON フィードで自作ブログパーツ</title>
  <meta name="viewport" content="width=device-width, initial-scale=1">
  <link rel="canonical" href="http://ishikawa.github.io/2008/06/15/display-flickr-photos-on-your-website-using-json-feed-api/">
  
  <link href="" rel="alternate" type="application/rss+xml" title="METAREAL" />
  <link rel="stylesheet" href="//maxcdn.bootstrapcdn.com/font-awesome/4.3.0/css/font-awesome.min.css">
  <link rel="stylesheet" href="css/normalize.css">
  <link rel="stylesheet" href="css/main.css">

  
  <link rel="stylesheet" href="http://ishikawa.github.io/css/application.min.32b5c9dd76f66e3fb16d1d2d9fb2dc1abf73acbd97c8192d1e573f3bc5ddeeb4.css">
  
  
  <link rel="stylesheet" href="http://ishikawa.github.io/css/application.ja.min.e3b0c44298fc1c149afbf4c8996fb92427ae41e4649b934ca495991b7852b855.css">
  <link rel="stylesheet" href="css/highlight/solarized_light.css">
  <script src="js/vendor/highlight.pack.js"></script>
  <script>hljs.initHighlightingOnLoad();</script>
</head>
<body>




<article>
  <h1>Flickr の JSON フィードで自作ブログパーツ</h1>
  <div class="metadata">
    <p class="date">
      2008/06/15 10:09am
    </p>
    <ul class="tags">
      
      <li>flickr</li>
      
      <li>json</li>
      
      <li>javascript</li>
      
    </ul>
  </div>
  <div class="content">
    <p>写真を撮るのが好きじゃない。</p>
<p>カメラは荷物になるし、壊れやすいから気をつかう。いざ撮影になると、バッグから取り出して、電源ボタンを押す、レンズを向ける、ピントを合わせて、と面倒だ。衆人環視の中、うんうん唸りながらシャッターを切るのも粋じゃない。</p>
<p>では、何が楽しくて写真を撮るのかといえば、補正が楽しい。<a href="http://www.adobe.com/jp/products/photoshopelwin/">Photoshop Elements</a> の自動補正がよく出来ていて、何も考えずにボタンを押していくだけで、それなりの見栄えになってくれる。これは楽しい（ただし、たまに自力で補正に挑戦しても、自動補正の方がキレイで気分が悪い）。</p>
<p>そのうち、出来上がった写真を他人に見せびらかしたくなるのが自然の流れ。写真を <a href="http://www.flickr.com/">Flickr</a> にアップロードするようになった。さらに、<a href="/2008/05/20/porting-weblog-to-google-app-engine/">このブログをリニューアル</a>するさいには、<a href="http://www.flickr.com/">Flickr</a> にアップロードした写真を表示するブログパーツを追加するつもりだった。</p>
<p>公式のブログパーツは <a href="http://www.flickr.com/badge.gne">Flickr Badge</a> という名前で Flash 版と HTML 版が用意されている。しかし、いくつかの理由により、どちらも使う気になれなかった。幸い、Flickr では<a href="http://www.flickr.com/services/feeds/">さまざまなフィードが提供されている</a>。これらを利用すれば、<strong>自作のブログパーツをつくるのは難しくない</strong>。</p>
<h3 id="公式ブログパーツの不満点">公式ブログパーツの不満点</h3>
<p>提供されているもので満足なら自作する必要はない。公式ブログパーツの不満点も挙げておこう。</p>
<p>まずは、Flash 版だが、</p>
<ul>
<li>サムネイルがちいさい</li>
<li>一定時間ごとにアニメーションで拡大するのは面白いが、読者からすれば煩わしいものだ</li>
</ul>
<p>という不満がある。</p>
<p>一方、HTML 版はというと、サムネイルの大きさは選択可能、レイアウトも CSS で設定できるので自由度も高い。ただし、ブログパーツを挿入するための JavaScript が好みじゃない（以下、一部整形済み）。</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-javascript" data-lang="javascript"><span style="color:#66d9ef">var</span> <span style="color:#a6e22e">b_txt</span> <span style="color:#f92672">=</span> <span style="color:#e6db74">&#39;&#39;</span>;

<span style="color:#a6e22e">b_txt</span><span style="color:#f92672">+=</span> <span style="color:#e6db74">&#39;&lt;div class=&#34;flickr_badge_image&#34; id=&#34;flickr_badge_image1&#34;&gt;&lt;a href=&#34;http://www.flickr.com/photos/ishikawa_takanori/2555186680/&#34;&gt;&lt;img src=&#34;http://farm4.static.flickr.com/3006/2555186680_7c18b8cc1a_s.jpg&#34; alt=&#34;A photo on Flickr&#34; title=&#34;BUFFET STYLE&#34; height=&#34;75&#34; width=&#34;75&#34;&gt;&lt;/a&gt;&lt;/div&gt;&#39;</span>;

<span style="color:#a6e22e">b_txt</span><span style="color:#f92672">+=</span> <span style="color:#e6db74">&#39;&lt;div class=&#34;flickr_badge_image&#34; id=&#34;flickr_badge_image2&#34;&gt;&lt;a href=&#34;http://www.flickr.com/photos/ishikawa_takanori/2555186616/&#34;&gt;&lt;img src=&#34;http://farm4.static.flickr.com/3140/2555186616_823d69311e_s.jpg&#34; alt=&#34;A photo on Flickr&#34; title=&#34;spaghetti with Genova style basil sauce&#34; height=&#34;75&#34; width=&#34;75&#34;&gt;&lt;/a&gt;&lt;/div&gt;&#39;</span>;

<span style="color:#a6e22e">b_txt</span><span style="color:#f92672">+=</span> <span style="color:#e6db74">&#39;&lt;div class=&#34;flickr_badge_image&#34; id=&#34;flickr_badge_image3&#34;&gt;&lt;a href=&#34;http://www.flickr.com/photos/ishikawa_takanori/2553633584/&#34;&gt;&lt;img src=&#34;http://farm4.static.flickr.com/3274/2553633584_0e3633ebe6_s.jpg&#34; alt=&#34;A photo on Flickr&#34; title=&#34;The Technorati Monster escaped again.&#34; height=&#34;75&#34; width=&#34;75&#34;&gt;&lt;/a&gt;&lt;/div&gt;&#39;</span>;

document.<span style="color:#a6e22e">write</span>(<span style="color:#a6e22e">b_txt</span>)
</code></pre></div><p>ごらんのとおり、古典的な <code>document.write</code> のブログパーツである。<a href="http://la.ma.la/blog/diary_200507160912.htm">最速インターフェース研究会 :: ページレンダリングを妨げない広告挿入手法に関する覚書</a>でも説明されているように、この手法だとページの表示を妨げる可能性がある。ブログパーツはあくまでオマケ。ページの表示が遅れるのは嬉しくない。</p>
<p>今回自作するブログパーツでは、ページの読み込み後にブログパーツの表示を行うことで、この問題による影響を軽減している。</p>
<h3 id="flickr-の-json-フィード">Flickr の JSON フィード</h3>
<p>Flickr では<a href="http://www.flickr.com/services/feeds/">さまざまなフィードが提供されている</a>が、ありがたいことに JSONP (JSON with Padding) 形式のフィードも提供されている。</p>
<p>JSONP については以下の記事に詳しい（最初の記事は <a href="http://mochikit.com/">MochiKit</a> の作者による解説。これが初出っぽい）。</p>
<ul>
<li><a href="http://bob.pythonmac.org/archives/2005/12/05/remote-json-jsonp/">from <strong>future</strong> import * » Remote JSON - JSONP</a></li>
<li><a href="http://www.baldanders.info/spiegel/remark/archives/000222.shtml">[鏡] 入門 JSON 3 &ndash; JSONP とコールバック関数 &ndash; 戯れ言++</a></li>
</ul>
<p>まずは、実例をみるのがいいだろう。</p>
<p>たとえば、<a href="http://api.flickr.com/services/feeds/photos_public.gne?id=23956121%40N00&amp;tags=green&amp;format=json">http://api.flickr.com/services/feeds/photos_public.gne?id=23956121%40N00&amp;tags=green&amp;format=json</a> を開くと、次のような JavaScript が返ってくる。</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-javascript" data-lang="javascript"><span style="color:#a6e22e">jsonFlickrFeed</span>({
    <span style="color:#e6db74">&#34;title&#34;</span><span style="color:#f92672">:</span> <span style="color:#e6db74">&#34;Uploads from Takanori Ishikawa, tagged green&#34;</span>,
    <span style="color:#e6db74">&#34;link&#34;</span><span style="color:#f92672">:</span> <span style="color:#e6db74">&#34;http://www.flickr.com/photos/ishikawa_takanori/tags/green/&#34;</span>,
    <span style="color:#e6db74">&#34;description&#34;</span><span style="color:#f92672">:</span> <span style="color:#e6db74">&#34;&#34;</span>,
    <span style="color:#e6db74">&#34;modified&#34;</span><span style="color:#f92672">:</span> <span style="color:#e6db74">&#34;2008-05-24T07:39:52Z&#34;</span>,
    <span style="color:#e6db74">&#34;generator&#34;</span><span style="color:#f92672">:</span> <span style="color:#e6db74">&#34;http://www.flickr.com/&#34;</span>,
    <span style="color:#e6db74">&#34;items&#34;</span><span style="color:#f92672">:</span> [
     {
      <span style="color:#e6db74">&#34;title&#34;</span><span style="color:#f92672">:</span> <span style="color:#e6db74">&#34;Shadow Game&#34;</span>,
      <span style="color:#e6db74">&#34;link&#34;</span><span style="color:#f92672">:</span> <span style="color:#e6db74">&#34;http://www.flickr.com/photos/ishikawa_takanori/2517368623/&#34;</span>,
      <span style="color:#e6db74">&#34;media&#34;</span><span style="color:#f92672">:</span> {<span style="color:#e6db74">&#34;m&#34;</span><span style="color:#f92672">:</span><span style="color:#e6db74">&#34;http://farm3.static.flickr.com/2141/2517368623_9c15a8e38dv&#34;</span>},
      <span style="color:#e6db74">&#34;date_taken&#34;</span><span style="color:#f92672">:</span> <span style="color:#e6db74">&#34;2008-05-04T15:15:36-08:00&#34;</span>,
      <span style="color:#e6db74">&#34;description&#34;</span><span style="color:#f92672">:</span> <span style="color:#e6db74">&#34;...&#34;</span>,
      <span style="color:#e6db74">&#34;published&#34;</span><span style="color:#f92672">:</span> <span style="color:#e6db74">&#34;2008-05-24T07:39:52Z&#34;</span>,
      <span style="color:#e6db74">&#34;author&#34;</span><span style="color:#f92672">:</span> <span style="color:#e6db74">&#34;nobody@flickr.com (Takanori Ishikawa)&#34;</span>,
      <span style="color:#e6db74">&#34;author_id&#34;</span><span style="color:#f92672">:</span> <span style="color:#e6db74">&#34;23956121@N00&#34;</span>,
      <span style="color:#e6db74">&#34;tags&#34;</span><span style="color:#f92672">:</span> <span style="color:#e6db74">&#34;green nara horyuji&#34;</span>
     },
...
        ]
})
</code></pre></div><p><strong>返ってくるのが JavaScript</strong> というのがミソで、つまり、次のような使い方ができる。</p>
<ol>
<li>上記 URL を <code>&lt;script&gt;</code> タグに指定し、JavaScript を読み込む</li>
<li>読み込みが完了すると、<code>jsonFlickrFeed</code> 関数が呼ばれる</li>
<li>そのときの引数は写真のデータを格納した連想配列</li>
</ol>
<p>このとき渡される引数の詳細については <a href="http://www.flickr.com/services/api/response.json.html">JSON Response Format</a> を参考にしてほしい（参照先にも書かれているように、呼び出される関数の名前を指定することも可能だ）。</p>
<p>では、実際に <a href="http://www.flickr.com/services/feeds/">Flickr JSON フィード</a>を使って、写真を表示してみよう。</p>
<p>この即席ブログパーツの <code>jsonFlickrFeed</code> 関数は以下のようになっている。</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-javascript" data-lang="javascript"><span style="color:#66d9ef">function</span> <span style="color:#a6e22e">jsonFlickrFeed</span>(<span style="color:#a6e22e">json</span>) {
  <span style="color:#66d9ef">var</span> <span style="color:#a6e22e">div</span> <span style="color:#f92672">=</span> document.<span style="color:#a6e22e">getElementById</span>(<span style="color:#e6db74">&#34;flickr-json-api-example-001&#34;</span>);
  <span style="color:#66d9ef">var</span> <span style="color:#a6e22e">items</span> <span style="color:#f92672">=</span> <span style="color:#a6e22e">json</span>.<span style="color:#a6e22e">items</span>.<span style="color:#a6e22e">slice</span>(<span style="color:#ae81ff">0</span>, <span style="color:#ae81ff">6</span>);

  <span style="color:#66d9ef">for</span> (<span style="color:#66d9ef">var</span> <span style="color:#a6e22e">i</span> <span style="color:#f92672">=</span> <span style="color:#ae81ff">0</span>; <span style="color:#a6e22e">i</span> <span style="color:#f92672">&lt;</span> <span style="color:#a6e22e">items</span>.<span style="color:#a6e22e">length</span>; <span style="color:#a6e22e">i</span><span style="color:#f92672">++</span>) {
    <span style="color:#66d9ef">var</span> <span style="color:#a6e22e">item</span> <span style="color:#f92672">=</span> <span style="color:#a6e22e">items</span>[<span style="color:#a6e22e">i</span>];
    <span style="color:#66d9ef">var</span> <span style="color:#a6e22e">a</span> <span style="color:#f92672">=</span> document.<span style="color:#a6e22e">createElement</span>(<span style="color:#e6db74">&#34;a&#34;</span>);
    <span style="color:#66d9ef">var</span> <span style="color:#a6e22e">img</span> <span style="color:#f92672">=</span> document.<span style="color:#a6e22e">createElement</span>(<span style="color:#e6db74">&#34;img&#34;</span>);
    <span style="color:#66d9ef">var</span> <span style="color:#a6e22e">media</span> <span style="color:#f92672">=</span> <span style="color:#a6e22e">item</span>.<span style="color:#a6e22e">media</span>.<span style="color:#a6e22e">m</span>.<span style="color:#a6e22e">replace</span>(<span style="color:#e6db74">/_m.(jpe?g)$/</span>, <span style="color:#e6db74">&#34;_t.$1&#34;</span>); <span style="color:#75715e">// (1)
</span><span style="color:#75715e"></span>
    <span style="color:#a6e22e">img</span>.<span style="color:#a6e22e">setAttribute</span>(<span style="color:#e6db74">&#34;src&#34;</span>, <span style="color:#a6e22e">media</span>);
    <span style="color:#a6e22e">a</span>.<span style="color:#a6e22e">setAttribute</span>(<span style="color:#e6db74">&#34;href&#34;</span>, <span style="color:#a6e22e">item</span>.<span style="color:#a6e22e">link</span>);
    <span style="color:#a6e22e">a</span>.<span style="color:#a6e22e">setAttribute</span>(<span style="color:#e6db74">&#34;title&#34;</span>, <span style="color:#a6e22e">item</span>.<span style="color:#a6e22e">title</span>);

    <span style="color:#a6e22e">a</span>.<span style="color:#a6e22e">appendChild</span>(<span style="color:#a6e22e">img</span>);
    <span style="color:#a6e22e">div</span>.<span style="color:#a6e22e">appendChild</span>(<span style="color:#a6e22e">a</span>);
  }
}
</code></pre></div><p>特に問題はないと思う。引数で渡される連想配列には <code>items</code> という名前で各写真のデータが入っている。それをループで回して <code>img</code> 要素を作成している。</p>
<p>説明がいるとすれば、写真の URL を正規表現でいじっている部分だろうか（コメントで <code>(1)</code> と書いた行）。Flickr の写真にはいくかのサイズがあって、それぞれに URL の形式が決まっている。このへんの写真 URL の形式については <a href="http://www.flickr.com/services/api/misc.urls.html">Photo Source URLs</a> が詳しい。</p>
<p>あとは、<code>script</code> 要素で JSON フィードの URL を指定する。</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-html" data-lang="html">&lt;<span style="color:#f92672">script</span> <span style="color:#a6e22e">src</span><span style="color:#f92672">=</span><span style="color:#e6db74">&#34;http://api.flickr.com/services/feeds/photos_public.gne?id=23956121%40N00&amp;amp;tags=popular&amp;amp;jsoncallback=flickrJsonAPIExample001&amp;amp;format=json&#34;</span> <span style="color:#a6e22e">type</span><span style="color:#f92672">=</span><span style="color:#e6db74">&#34;text/javascript&#34;</span> <span style="color:#a6e22e">charset</span><span style="color:#f92672">=</span><span style="color:#e6db74">&#34;utf-8&#34;</span>&gt;&lt;/<span style="color:#f92672">script</span>&gt;
</code></pre></div><p>また、この <code>script</code> 要素を置く場所を <code>&lt;/body&gt;</code> タグの直前にしておけば、JavaScript の読み込みがはじまったときには他の部分が表示されているので、ページの表示の妨げになりにくい。</p>
<h3 id="json-フィードの手軽さ">JSON フィードの手軽さ</h3>
<p>Flickr が JSON フィードを利用すれば、写真を表示するブログパーツが簡単に自作できることが分かった。</p>
<p>JavaScript と親和性が高いのみならず、ただの外部スクリプト読み込みなので、<code>XMLHttpRequest</code> につきもののクロスドメイン制限がないのもありがたい。</p>
<p>最後に、参考リンクをまとめておく。</p>
<ul>
<li><a href="http://www.flickr.com/services/feeds/">Flickr で提供されているフィード一覧</a></li>
<li><a href="http://www.flickr.com/services/api/misc.urls.html">写真の URL の形式について</a></li>
<li><a href="http://www.flickr.com/services/api/response.json.html">JSONP で渡される引数について</a></li>
<li><a href="http://www.flickr.com/services/api/explore/?method=flickr.favorites.getList">Flickr API Explorer</a> API のテスト用ページ。自分の User ID を確認できる</li>
</ul>

  </div>
</article>

<nav class="pagination">
  <ul>
    
    <li class="next"><i class="fa fa-angle-left"></i><a href="http://ishikawa.github.io/2008/06/26/java-generater-by-using-kilim/">kilim で Java でもジェネレーター</a></li>
    
    
    <li class="prev"><a href="http://ishikawa.github.io/2008/06/06/280slides-in-objective-j/">280Slides in Objective-J</a><i class="fa fa-angle-right"></i></li>
    
  </ul>
</nav>

<footer>
  <ul class="about">
    <li class="mail"><a href="mailto:takanori.ishikawa@gmail.com"><span class='symbol'>&#xe224;</span></a></li>
    <li class="twitter"><a href="https://twitter.com/takanori_is"><span class='symbol'>&#xe286;</span></a></li>
    <li class="github"><a href="https://github.com/ishikawa"><span class='symbol'>&#xe237;</span></a></li>
  </ul>
  <h2><a href="/ja">METAREAL</a></h2>
  <p class="copyright">copyright &copy; 2006-Present Takanori Ishikawa</p>
</footer>


<script type="text/x-mathjax-config">
MathJax.Hub.Config({
  showProcessingMessages: false,
  messageStyle: 'none',
  tex2jax: {
    inlineMath: [['$','$'], ['\\(','\\)']],
    displayMath: [['$$','$$'], ['\\[','\\]']],
    processEscapes: true,
    processEnvironments: true,
    skipTags: ['script', 'noscript', 'style', 'textarea', 'pre'],
    TeX: { equationNumbers: { autoNumber: "AMS" },
         extensions: ["AMSmath.js", "AMSsymbols.js"] }
  }
});
</script>

<script type="text/x-mathjax-config">
MathJax.Hub.Queue(function() {
  // Fix <code> tags after MathJax finishes running. This is a
  // hack to overcome a shortcoming of Markdown. Discussion at
  // https://github.com/mojombo/jekyll/issues/199
  var all = MathJax.Hub.getAllJax(), i;
  for(i = 0; i &lt; all.length; i += 1) {
      all[i].SourceElement().parentNode.className += ' has-jax';
  }
});
</script>
<script type="text/javascript"
  src="https://cdn.mathjax.org/mathjax/latest/MathJax.js?config=TeX-AMS-MML_HTMLorMML"></script>


</body>
</html>
